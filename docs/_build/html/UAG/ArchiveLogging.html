

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6. Archive Logging &mdash; pcp  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Performance Co-Pilot Deployment Strategies" href="PcpDeploymentStrategies.html" />
    <link rel="prev" title="5. Performance Metrics Inference Engine" href="PerformanceMetricsInferenceEngine.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> pcp
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AboutThisGuide.html">About User’s and Administrator’s Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">User's and Administrator's Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="IntroductionToPcp.html">1. Introduction to PCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="InstallingAndConfiguringPcp.html">2. Installing and Configuring Performance Co-Pilot</a></li>
<li class="toctree-l1"><a class="reference internal" href="CommonConventionsAndArguments.html">3. Common Conventions and Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="MonitoringSystemPerformance.html">4. Monitoring System Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="PerformanceMetricsInferenceEngine.html">5. Performance Metrics Inference Engine</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. Archive Logging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction-to-archive-logging">6.1. Introduction to Archive Logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#archive-logs-and-the-pmapi">6.1.1. ⁠Archive Logs and the PMAPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retrospective-analysis-using-archive-logs">6.1.2. ⁠Retrospective Analysis Using Archive Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-archive-logs-for-capacity-planning">6.1.3. ⁠Using Archive Logs for Capacity Planning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-archive-logs-with-performance-tools">6.2. Using Archive Logs with Performance Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#coordination-between-pmlogger-and-pcp-tools">6.2.1. ⁠Coordination between pmlogger and PCP tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="#administering-pcp-archive-logs-using-cron-scripts">6.2.2. ⁠Administering PCP Archive Logs Using cron Scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#archive-log-file-management">6.2.3. Archive Log File Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basename-conventions">6.2.3.1. Basename Conventions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#log-volumes">6.2.3.2. Log Volumes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#basenames-for-managed-archive-log-files">6.2.3.3. Basenames for Managed Archive Log Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#directory-organization-for-archive-log-files">6.2.3.4. Directory Organization for Archive Log Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-of-pmlogger">6.2.3.5. Configuration of pmlogger</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pcp-archive-contents">6.2.3.6. ⁠PCP Archive Contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cookbook-for-archive-logging">6.3. Cookbook for Archive Logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#primary-logger">6.3.1. ⁠Primary Logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-logger-configurations">6.3.2. ⁠Other Logger Configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#archive-log-administration">6.3.3. ⁠Archive Log Administration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#other-archive-logging-features-and-services">6.4. Other Archive Logging Features and Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pcp-archive-folios">6.4.1. ⁠PCP Archive Folios</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manipulating-archive-logs-with-pmlogextract">6.4.2. ⁠Manipulating Archive Logs with pmlogextract</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summarizing-archive-logs-with-pmlogsummary">6.4.3. ⁠Summarizing Archive Logs with pmlogsummary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">6.4.4. ⁠Primary Logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-pmlc">6.4.5. ⁠Using pmlc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#archive-logging-troubleshooting">6.5. Archive Logging Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pmlogger-cannot-write-log">6.5.1. pmlogger Cannot Write Log</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cannot-find-log">6.5.2. ⁠Cannot Find Log</a></li>
<li class="toctree-l3"><a class="reference internal" href="#primary-pmlogger-cannot-start">6.5.3. Primary pmlogger Cannot Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#identifying-an-active-pmlogger-process">6.5.4. Identifying an Active pmlogger Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#illegal-label-record">6.5.5. Illegal Label Record</a></li>
<li class="toctree-l3"><a class="reference internal" href="#empty-archive-log-files-or-pmlogger-exits-immediately">6.5.6. ⁠Empty Archive Log Files or pmlogger Exits Immediately</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PcpDeploymentStrategies.html">7. Performance Co-Pilot Deployment Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="CustomizingAndExtendingPcpServices.html">8. Customizing and Extending PCP Services</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pcp</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>6. Archive Logging</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/UAG/ArchiveLogging.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="archive-logging">
<span id="archivelogging"></span><h1><a class="toc-backref" href="#id3">6. Archive Logging</a><a class="headerlink" href="#archive-logging" title="Permalink to this headline">¶</a></h1>
<p>Performance monitoring and management in complex systems demands the ability to accurately capture performance characteristics for subsequent review, analysis, and comparison. Performance Co-Pilot (PCP) provides extensive support for the creation and management of archive logs that capture a user-specified profile of performance information to support retrospective performance analysis.</p>
<p>The following major sections are included in this chapter:</p>
<p>Section 6.1, “<a class="reference internal" href="#introduction-to-archive-logging">Introduction to Archive Logging</a>”, presents the concepts and issues involved with creating and using archive logs.</p>
<p>Section 6.2, “<a class="reference internal" href="#using-archive-logs-with-performance-tools">Using Archive Logs with Performance Tools</a>”, describes the interaction of the PCP tools with archive logs.</p>
<p>Section 6.3, “<a class="reference internal" href="#cookbook-for-archive-logging">Cookbook for Archive Logging</a>”, shows some shortcuts for setting up useful PCP archive logs.</p>
<p>Section 6.4, “<a class="reference internal" href="#other-archive-logging-features-and-services">Other Archive Logging Features and Services</a>”, provides information about other archive logging features and sevices.</p>
<p>Section 6.5, “<a class="reference internal" href="#archive-logging-troubleshooting">Archive Logging Troubleshooting</a>”, presents helpful directions if your archive logging implementation is not functioning correctly.</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#archive-logging" id="id3">Archive Logging</a><ul>
<li><a class="reference internal" href="#introduction-to-archive-logging" id="id4">Introduction to Archive Logging</a><ul>
<li><a class="reference internal" href="#archive-logs-and-the-pmapi" id="id5">⁠Archive Logs and the PMAPI</a></li>
<li><a class="reference internal" href="#retrospective-analysis-using-archive-logs" id="id6">⁠Retrospective Analysis Using Archive Logs</a></li>
<li><a class="reference internal" href="#using-archive-logs-for-capacity-planning" id="id7">⁠Using Archive Logs for Capacity Planning</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-archive-logs-with-performance-tools" id="id8">Using Archive Logs with Performance Tools</a><ul>
<li><a class="reference internal" href="#coordination-between-pmlogger-and-pcp-tools" id="id9">⁠Coordination between pmlogger and PCP tools</a></li>
<li><a class="reference internal" href="#administering-pcp-archive-logs-using-cron-scripts" id="id10">⁠Administering PCP Archive Logs Using cron Scripts</a></li>
<li><a class="reference internal" href="#archive-log-file-management" id="id11">Archive Log File Management</a><ul>
<li><a class="reference internal" href="#basename-conventions" id="id12">Basename Conventions</a></li>
<li><a class="reference internal" href="#log-volumes" id="id13">Log Volumes</a></li>
<li><a class="reference internal" href="#basenames-for-managed-archive-log-files" id="id14">Basenames for Managed Archive Log Files</a></li>
<li><a class="reference internal" href="#directory-organization-for-archive-log-files" id="id15">Directory Organization for Archive Log Files</a></li>
<li><a class="reference internal" href="#configuration-of-pmlogger" id="id16">Configuration of pmlogger</a></li>
<li><a class="reference internal" href="#pcp-archive-contents" id="id17">⁠PCP Archive Contents</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#cookbook-for-archive-logging" id="id18">Cookbook for Archive Logging</a><ul>
<li><a class="reference internal" href="#primary-logger" id="id19">⁠Primary Logger</a></li>
<li><a class="reference internal" href="#other-logger-configurations" id="id20">⁠Other Logger Configurations</a></li>
<li><a class="reference internal" href="#archive-log-administration" id="id21">⁠Archive Log Administration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-archive-logging-features-and-services" id="id22">Other Archive Logging Features and Services</a><ul>
<li><a class="reference internal" href="#pcp-archive-folios" id="id23">⁠PCP Archive Folios</a></li>
<li><a class="reference internal" href="#manipulating-archive-logs-with-pmlogextract" id="id24">⁠Manipulating Archive Logs with pmlogextract</a></li>
<li><a class="reference internal" href="#summarizing-archive-logs-with-pmlogsummary" id="id25">⁠Summarizing Archive Logs with pmlogsummary</a></li>
<li><a class="reference internal" href="#id1" id="id26">⁠Primary Logger</a></li>
<li><a class="reference internal" href="#using-pmlc" id="id27">⁠Using pmlc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#archive-logging-troubleshooting" id="id28">Archive Logging Troubleshooting</a><ul>
<li><a class="reference internal" href="#pmlogger-cannot-write-log" id="id29">pmlogger Cannot Write Log</a></li>
<li><a class="reference internal" href="#cannot-find-log" id="id30">⁠Cannot Find Log</a></li>
<li><a class="reference internal" href="#primary-pmlogger-cannot-start" id="id31">Primary pmlogger Cannot Start</a></li>
<li><a class="reference internal" href="#identifying-an-active-pmlogger-process" id="id32">Identifying an Active pmlogger Process</a></li>
<li><a class="reference internal" href="#illegal-label-record" id="id33">Illegal Label Record</a></li>
<li><a class="reference internal" href="#empty-archive-log-files-or-pmlogger-exits-immediately" id="id34">⁠Empty Archive Log Files or pmlogger Exits Immediately</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction-to-archive-logging">
<h2><a class="toc-backref" href="#id4">6.1. Introduction to Archive Logging</a><a class="headerlink" href="#introduction-to-archive-logging" title="Permalink to this headline">¶</a></h2>
<p>Within the PCP, the <strong>pmlogger</strong> utility may be configured to collect archives of performance metrics. The archive creation process is simple and very flexible, incorporating the following features:</p>
<ul class="simple">
<li>Archive log creation at either a PCP collector (typically a server) or a PCP monitor system (typically a workstation), or at some designated PCP archive logger host.</li>
<li>Concurrent independent logging, both local and remote. The performance analyst can activate a private <strong>pmlogger</strong> instance to collect only the metrics of interest for the problem at hand,
independent of other logging on the workstation or remote host.</li>
<li>Independent determination of logging frequency for individual metrics or metric instances. For example, you could log the “5 minute” load average every half hour, the
write I/O rate on the DBMS log spindle every 10 seconds, and aggregate I/O rates on the other disks every minute.</li>
<li>Dynamic adjustment of what is to be logged, and how frequently, via <strong>pmlc</strong>. This feature may be used to disable logging or to increase the sample interval during
periods of low activity or chronic high activity. A local <strong>pmlc</strong> may interrogate and control a remote <strong>pmlogger</strong>, subject to the access control restrictions
implemented by <strong>pmlogger</strong>.</li>
<li>Self-contained logs that include all system configuration and metadata required to interpret the values in the log. These logs can be kept for analysis at a much
later time, potentially after the hardware or software has been reconfigured and the logs have been stored as discrete, autonomous files for remote analysis. The logs
are endian-neutral and platform independent - there is no requirement that the monitor host machine used for analysis be similar to the collector machine in any way,
nor do they have to have the same versions of PCP. PCP archives created over 15 years ago can still be replayed with the current versions of PCP!</li>
<li><strong>cron</strong>-based scripts to expedite the operational management, for example, log rotation, consolidation, and culling. Another helper tool, <strong>pmlogconf</strong> can be used to
generate suitable logging configurations for a variety of situations.</li>
<li>Archive folios as a convenient aggregation of multiple archive logs. Archive folios may be created with the <strong>mkaf</strong> utility and processed with the <strong>pmafm</strong> tool.</li>
</ul>
<div class="section" id="archive-logs-and-the-pmapi">
<h3><a class="toc-backref" href="#id5">6.1.1. ⁠Archive Logs and the PMAPI</a><a class="headerlink" href="#archive-logs-and-the-pmapi" title="Permalink to this headline">¶</a></h3>
<p>Critical to the success of the PCP archive logging scheme is the fact that the library routines providing access to real-time feeds of performance metrics also provide
access to the archive logs.</p>
<p>Live feeds (or real-time) sources of performance metrics and archives are literally interchangeable, with a single Performance Metrics Application Programming Interface
(PMAPI) that preserves the same semantics for both styles of metric source. In this way, applications and tools developed against the PMAPI can automatically process
either live or historical performance data.</p>
</div>
<div class="section" id="retrospective-analysis-using-archive-logs">
<h3><a class="toc-backref" href="#id6">6.1.2. ⁠Retrospective Analysis Using Archive Logs</a><a class="headerlink" href="#retrospective-analysis-using-archive-logs" title="Permalink to this headline">¶</a></h3>
<p>One of the most important applications of archive logging services provided by PCP is in the area of retrospective analysis. In many cases, understanding today’s
performance problems can be assisted by side-by-side comparisons with yesterday’s performance. With routine creation of performance archive logs, you can concurrently
replay pictures of system performance for two or more periods in the past.</p>
<p>Archive logs are also an invaluable source of intelligence when trying to diagnose what went wrong, as in a performance post-mortem. Because the PCP archive logs are
entirely self-contained, this analysis can be performed off-site if necessary.</p>
<p>Each archive log contains metric values from only one host. However, many PCP tools can simultaneously visualize values from multiple archives collected from different hosts.</p>
<p>The archives can be replayed using the inference engine (<strong>pmie</strong> is an application that uses the PMAPI). This allows you to automate the regular, first-level analysis of system performance.</p>
<p>Such analysis can be performed by constructing suitable expressions to capture the essence of common resource saturation problems, then periodically creating an archive
and playing it against the expressions. For example, you may wish to create a daily performance audit (perhaps run by the cron command) to detect performance regressions.</p>
<p>For more about pmie, see Chapter 5, <a class="reference internal" href="PerformanceMetricsInferenceEngine.html#performance-metrics-inference-engine"><span class="std std-ref">Performance Metrics Inference Engine</span></a>.</p>
</div>
<div class="section" id="using-archive-logs-for-capacity-planning">
<h3><a class="toc-backref" href="#id7">6.1.3. ⁠Using Archive Logs for Capacity Planning</a><a class="headerlink" href="#using-archive-logs-for-capacity-planning" title="Permalink to this headline">¶</a></h3>
<p>By collecting performance archives with relatively long sampling periods, or by reducing the daily archives to produce summary logs, the capacity planner can collect
the base data required for forward projections, and can estimate resource demands and explore “what if” scenarios by replaying data using visualization tools and the
inference engine.</p>
</div>
</div>
<div class="section" id="using-archive-logs-with-performance-tools">
<h2><a class="toc-backref" href="#id8">6.2. Using Archive Logs with Performance Tools</a><a class="headerlink" href="#using-archive-logs-with-performance-tools" title="Permalink to this headline">¶</a></h2>
<p>Most PCP tools default to real-time display of current values for performance metrics from PCP collector host(s). However, most PCP tools also have the capability to
display values for performance metrics retrieved from PCP archive log(s). The following sections describe plans, steps, and general issues involving archive logs and
the PCP tools.</p>
<div class="section" id="coordination-between-pmlogger-and-pcp-tools">
<h3><a class="toc-backref" href="#id9">6.2.1. ⁠Coordination between pmlogger and PCP tools</a><a class="headerlink" href="#coordination-between-pmlogger-and-pcp-tools" title="Permalink to this headline">¶</a></h3>
<p>Most commonly, a PCP tool would be invoked with the <strong>-a</strong> option to process sets of archive logs some time after pmlogger had finished creating the archive.
However, a tool such as <strong>pmchart</strong> that uses a Time Control dialog (see Section 3.3, “<a class="reference internal" href="CommonConventionsAndArguments.html#time-duration-and-control"><span class="std std-ref">Time Duration and Control</span></a>”) stops when the end of a set of archives is
reached, but could resume if more data is written to the PCP archive log.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>pmlogger</strong> uses buffered I/O to write the archive log so that the end of the archive may be aligned with an I/O buffer boundary, rather than with a logical
archive log record. If such an archive was read by a PCP tool, it would appear truncated and might confuse the tool. These problems may be avoided by sending
<strong>pmlogger</strong> a <strong>SIGUSR1</strong> signal, or by using the <strong>flush</strong> command of <strong>pmlc</strong> to force <strong>pmlogger</strong> to flush its output buffers.</p>
</div>
</div>
<div class="section" id="administering-pcp-archive-logs-using-cron-scripts">
<h3><a class="toc-backref" href="#id10">6.2.2. ⁠Administering PCP Archive Logs Using cron Scripts</a><a class="headerlink" href="#administering-pcp-archive-logs-using-cron-scripts" title="Permalink to this headline">¶</a></h3>
<p>Many operating systems support the <strong>cron</strong> process scheduling system.</p>
<p>PCP supplies shell scripts to use the <strong>cron</strong> functionality to help manage your archive logs. The following scripts are supplied:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Script</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>pmlogger_daily(1)</td>
<td>Performs a daily housecleaning of archive logs and notices.</td>
</tr>
<tr class="row-odd"><td>pmlogger_merge(1)</td>
<td>Merges archive logs and is called by <strong>pmlogger_daily</strong>.</td>
</tr>
<tr class="row-even"><td>pmlogger_check(1)</td>
<td>Checks to see that all desired <strong>pmlogger</strong> processes are running on your system, and invokes any that are missing for any reason.</td>
</tr>
<tr class="row-odd"><td>pmlogconf(1)</td>
<td>Generates suitable <strong>pmlogger</strong> configuration files based on a pre-defined set of templates. It can probe the state of the system under
observation to make informed decisions about which metrics to record. This is an extensible facility, allowing software upgrades and new
PMDA installations to add to the existing set of templates.</td>
</tr>
<tr class="row-even"><td>pmsnap(1)</td>
<td>Generates graphic image snapshots of <strong>pmchart</strong> performance charts at regular intervals.</td>
</tr>
</tbody>
</table>
<p>The configuration files used by these scripts can be edited to suit your particular needs, and are generally controlled by the <code class="docutils literal notranslate"><span class="pre">${PCP_PMLOGGERCONTROL_PATH}</span></code>
and <code class="docutils literal notranslate"><span class="pre">${PCP_PMLOGGERCONTROL_PATH}.d</span></code> files (<strong>pmsnap</strong> has an additional control file, <code class="docutils literal notranslate"><span class="pre">${PCP_PMSNAPCONTROL_PATH}</span></code>). Complete information on these scripts is
available in the <strong>pmlogger_daily(1)</strong> and <strong>pmsnap(1)</strong> man pages.</p>
</div>
<div class="section" id="archive-log-file-management">
<h3><a class="toc-backref" href="#id11">6.2.3. Archive Log File Management</a><a class="headerlink" href="#archive-log-file-management" title="Permalink to this headline">¶</a></h3>
<p>PCP archive log files can occupy a great deal of disk space, and management of archive logs can be a large task in itself. The following sections provide information
to assist you in PCP archive log file management.</p>
<div class="section" id="basename-conventions">
<h4><a class="toc-backref" href="#id12">6.2.3.1. Basename Conventions</a><a class="headerlink" href="#basename-conventions" title="Permalink to this headline">¶</a></h4>
<p>When a PCP archive is created by <strong>pmlogger</strong>, an archive basename must be specified and several physical files are created, as shown in <a class="reference internal" href="#table-6-1-filenames-for-pcp-archive-log-components-archive">Table 6.1. Filenames for PCP Archive Log Components (archive.*)</a>.</p>
<p id="table-6-1-filenames-for-pcp-archive-log-components-archive"><strong>Table 6.1. Filenames for PCP Archive Log Components (archive.*)</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Filename</th>
<th class="head">Contents</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>archive.</strong> <em>index</em></td>
<td>Temporal index for rapid access to archive contents.</td>
</tr>
<tr class="row-odd"><td><strong>archive.</strong> <em>meta</em></td>
<td>Metadata descriptions for performance metrics and instance domains appearing in the archive.</td>
</tr>
<tr class="row-even"><td><strong>archive.N</strong></td>
<td>Volumes of performance metrics values, for <strong>N</strong> = 0,1,2,…</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="log-volumes">
<h4><a class="toc-backref" href="#id13">6.2.3.2. Log Volumes</a><a class="headerlink" href="#log-volumes" title="Permalink to this headline">¶</a></h4>
<p>A single PCP archive may be partitioned into a number of volumes. These volumes may expedite management of the archive; however, the metadata file and at least one
volume must be present before a PCP tool can process the archive.</p>
<p>You can control the size of an archive log volume by using the <strong>-v</strong> command line option to <strong>pmlogger</strong>. This option specifies how large a volume should become
before pmlogger starts a new volume. Archive log volumes retain the same base filename as other files in the archive log, and are differentiated by a numeric suffix
that is incremented with each volume change. For example, you might have a log volume sequence that looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">netserver</span><span class="o">-</span><span class="n">log</span><span class="o">.</span><span class="mi">0</span>
<span class="n">netserver</span><span class="o">-</span><span class="n">log</span><span class="o">.</span><span class="mi">1</span>
<span class="n">netserver</span><span class="o">-</span><span class="n">log</span><span class="o">.</span><span class="mi">2</span>
</pre></div>
</div>
<p>You can also cause an existing log to be closed and a new one to be opened by sending a <strong>SIGHUP</strong> signal to <strong>pmlogger</strong>, or by using the <strong>pmlc</strong> command to change
the <strong>pmlogger</strong> instructions dynamically, without interrupting <strong>pmlogger</strong> operation. Complete information on log volumes is found in the <strong>pmlogger(1)</strong> man page.</p>
</div>
<div class="section" id="basenames-for-managed-archive-log-files">
<h4><a class="toc-backref" href="#id14">6.2.3.3. Basenames for Managed Archive Log Files</a><a class="headerlink" href="#basenames-for-managed-archive-log-files" title="Permalink to this headline">¶</a></h4>
<p>The PCP archive management tools support a consistent scheme for selecting the basenames for the files in a collection of archives and for mapping these files to a suitable directory hierarchy.</p>
<p>Once configured, the PCP tools that manage archive logs employ a consistent scheme for selecting the basename for an archive each time <strong>pmlogger</strong> is launched,
namely the current date and time in the format YYYYMMDD.HH.MM. Typically, at the end of each day, all archives for a particular host on that day would be merged to
produce a single archive with a basename constructed from the date, namely YYYYMMDD. The <strong>pmlogger_daily</strong> script performs this action and a number of other routine
housekeeping chores.</p>
</div>
<div class="section" id="directory-organization-for-archive-log-files">
<h4><a class="toc-backref" href="#id15">6.2.3.4. Directory Organization for Archive Log Files</a><a class="headerlink" href="#directory-organization-for-archive-log-files" title="Permalink to this headline">¶</a></h4>
<p>If you are using a deployment of PCP tools and daemons to collect metrics from a variety of hosts and storing them all at a central location, you should develop an organized strategy for storing and
naming your log files.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There are many possible configurations of <strong>pmlogger</strong>, as described in Section 7.3, “<a class="reference internal" href="PcpDeploymentStrategies.html#pcp-archive-logger-deployment"><span class="std std-ref">PCP Archive Logger Deployment</span></a>”. The directory organization described in this
section is recommended for any system on which <strong>pmlogger</strong> is configured for permanent execution (as opposed to short-term executions, for example, as launched from
<strong>pmchart</strong> to record some performance data of current interest).</p>
</div>
<p>Typically, the filesystem structure can be used to reflect the number of hosts for which a <strong>pmlogger</strong> instance is expected to be running locally, obviating the need
for lengthy and cumbersome filenames. It makes considerable sense to place all logs for a particular host in a separate directory named after that host. Because each
instance of <strong>pmlogger</strong> can only log metrics fetched from a single host, this also simplifies some of the archive log management and administration tasks.</p>
<p>For example, consider the filesystem and naming structure shown in <a class="reference internal" href="#figure-6-1-archive-log-directory-structure">Figure 6.1. Archive Log Directory Structure</a>.</p>
<div class="figure" id="id2">
<span id="figure-6-1-archive-log-directory-structure"></span><img alt="../_images/log-directory.png" src="../_images/log-directory.png" />
<p class="caption"><span class="caption-text">Figure 6.1. Archive Log Directory Structure</span></p>
</div>
<p>The specification of where to place the archive log files for particular <strong>pmlogger</strong> instances is encoded in the <code class="docutils literal notranslate"><span class="pre">${PCP_PMLOGGERCONTROL_PATH}</span></code> and
<code class="docutils literal notranslate"><span class="pre">${PCP_PMLOGGERCONTROL_PATH}.d</span></code> configuration files, and these files should be customized on each host running an instance of <strong>pmlogger</strong>.</p>
<p>If many archives are being created, and the associated PCP collector systems form peer classes based upon service type (Web servers, DBMS servers, NFS servers, and so
on), then it may be appropriate to introduce another layer into the directory structure, or use symbolic links to group together hosts providing similar service types.</p>
</div>
<div class="section" id="configuration-of-pmlogger">
<h4><a class="toc-backref" href="#id16">6.2.3.5. Configuration of pmlogger</a><a class="headerlink" href="#configuration-of-pmlogger" title="Permalink to this headline">¶</a></h4>
<p>The configuration files used by <strong>pmlogger</strong> describe which metrics are to be logged. Groups of metrics may be logged at different intervals to other groups of metrics.
Two states, mandatory and advisory, also apply to each group of metrics, defining whether metrics definitely should be logged or not logged, or whether a later advisory
definition may change that state.</p>
<p>The mandatory state takes precedence if it is <strong>on</strong> or <strong>off</strong>, causing any subsequent request for a change in advisory state to have no effect. If the mandatory state
is <strong>maybe</strong>, then the advisory state determines if logging is enabled or not.</p>
<p>The mandatory states are <strong>on</strong>, <strong>off</strong>, and <strong>maybe</strong>. The advisory states, which only affect metrics that are mandatory <strong>maybe</strong>, are <strong>on</strong> and <strong>off</strong>. Therefore,
a metric that is mandatory <strong>maybe</strong> in one definition and advisory <strong>on</strong> in another definition would be logged at the advisory interval. Metrics that are not specified
in the <strong>pmlogger</strong> configuration file are mandatory <strong>maybe</strong> and advisory <strong>off</strong> by default and are not logged.</p>
<p>A complete description of the <strong>pmlogger</strong> configuration format can be found on the <strong>pmlogger(1)</strong> man page.</p>
</div>
<div class="section" id="pcp-archive-contents">
<h4><a class="toc-backref" href="#id17">6.2.3.6. ⁠PCP Archive Contents</a><a class="headerlink" href="#pcp-archive-contents" title="Permalink to this headline">¶</a></h4>
<p>Once a PCP archive log has been created, the <strong>pmdumplog</strong> utility may be used to display various information about the contents of the archive. For example, start with
the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">pmdumplog</span> <span class="pre">-l</span> <span class="pre">${PCP_LOG_DIR}/pmlogger/www.sgi.com/19960731</span></code></p>
<p>It might produce the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Log Label (Log Format Version 1)
Performance metrics from host www.sgi.com
     commencing Wed Jul 31 00:16:34.941 1996
     ending     Thu Aug  1 00:18:01.468 1996
</pre></div>
</div>
<p>The simplest way to discover what performance metrics are contained within a set of archives is to use <strong>pminfo</strong> as shown in <a class="reference internal" href="#example-6-1-using-pminfo-to-obtain-archive-information">Example 6.1. Using pminfo to Obtain Archive Information</a>:</p>
<p id="example-6-1-using-pminfo-to-obtain-archive-information">Example 6.1. Using pminfo to Obtain Archive Information</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pminfo -a ${PCP_LOG_DIR}/pmlogger/www.sgi.com/19960731 network.mbuf
network.mbuf.alloc
network.mbuf.typealloc
network.mbuf.clustalloc
network.mbuf.clustfree
network.mbuf.failed
network.mbuf.waited
network.mbuf.drained
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cookbook-for-archive-logging">
<h2><a class="toc-backref" href="#id18">6.3. Cookbook for Archive Logging</a><a class="headerlink" href="#cookbook-for-archive-logging" title="Permalink to this headline">¶</a></h2>
<p>The following sections present a checklist of tasks that may be performed to enable PCP archive logging with minimal effort. For a complete explanation, refer to the
other sections in this chapter and the man pages for <strong>pmlogger</strong> and related tools.</p>
<div class="section" id="primary-logger">
<h3><a class="toc-backref" href="#id19">6.3.1. ⁠Primary Logger</a><a class="headerlink" href="#primary-logger" title="Permalink to this headline">¶</a></h3>
<p>Assume you wish to activate primary archive logging on the PCP collector host <strong>pluto</strong>. Execute the following while logged into <strong>pluto</strong> as the superuser (<strong>root</strong>).</p>
<ol class="arabic">
<li><p class="first">Start pmcd and pmlogger:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>chkconfig pmcd on
chkconfig pmlogger on
${PCP_RC_DIR}/pmcd start
Starting pmcd ...
${PCP_RC_DIR}/pmlogger start
Starting pmlogger ...
</pre></div>
</div>
</li>
<li><p class="first">Verify that the primary <strong>pmlogger</strong> instance is running:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pcp
Performance Co-Pilot configuration on pluto:

 platform: Linux pluto 3.10.0-0.rc7.64.el7.x86_64 #1 SMP
 hardware: 8 cpus, 2 disks, 23960MB RAM
 timezone: EST-10
     pmcd: Version 4.0.0-1, 8 agents
     pmda: pmcd proc xfs linux mmv infiniband gluster elasticsearch
     pmlogger: primary logger: pluto/20170815.10.00
     pmie: pluto: ${PCP_LOG_DIR}/pmie/pluto/pmie.log
           venus: ${PCP_LOG_DIR}/pmie/venus/pmie.log
</pre></div>
</div>
</li>
<li><p class="first">Verify that the archive files are being created in the expected place:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ls ${PCP_LOG_DIR}/pmlogger/pluto
20170815.10.00.0
20170815.10.00.index
20170815.10.00.meta
Latest
pmlogger.log
</pre></div>
</div>
</li>
<li><p class="first">Verify that no errors are being logged, and the rate of expected growth of the archives:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat ${PCP_LOG_DIR}/pmlogger/pluto/pmlogger.log
Log for pmlogger on pluto started Thu Aug 15 10:00:11 2017

Config parsed
Starting primary logger for host &quot;pluto&quot;
Archive basename: 20170815.00.10

Group [26 metrics] {
            hinv.map.lvname
            ...
            hinv.ncpu
} logged once: 1912 bytes

Group [11 metrics] {
            kernel.all.cpu.user
            ...
            kernel.all.load
} logged every 60 sec: 372 bytes or 0.51 Mbytes/day

...
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="other-logger-configurations">
<h3><a class="toc-backref" href="#id20">6.3.2. ⁠Other Logger Configurations</a><a class="headerlink" href="#other-logger-configurations" title="Permalink to this headline">¶</a></h3>
<p>Assume you wish to create archive logs on the local host for performance metrics collected from the remote host venus. Execute all of the following tasks while logged
into the local host as the superuser (<strong>root</strong>).</p>
<p id="procedure-6-1-creating-archive-logs"><strong>Procedure 6.1. Creating Archive Logs</strong></p>
<ol class="arabic">
<li><p class="first">Create a suitable <strong>pmlogger</strong> configuration file. There are several options:</p>
<ul class="simple">
<li>Run the <strong>pmlogconf(1)</strong> utility to generate a configuration file, and (optionally) interactively customize it further to suit local needs.</li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>${PCP_BINADM_DIR}/pmlogconf ${PCP_SYSCONF_DIR}/pmlogger/config.venus
Creating config file &quot;${PCP_SYSCONF_DIR}/pmlogger/config.venus&quot; using default settings

${PCP_BINADM_DIR}/pmlogconf ${PCP_SYSCONF_DIR}/pmlogger/config.venus

Group: utilization per CPU
Log this group? [n] y
Logging interval? [default]

Group: utilization (usr, sys, idle, ...) over all CPUs
Log this group? [y] y
Logging interval? [default]

Group: per spindle disk activity
Log this group? [n] y

...
</pre></div>
</div>
<p>Do nothing - a default configuration will be created in the following step, using <strong>pmlogconf(1)</strong> probing and automatic file generation based on the metrics
available at the remote host. The <code class="docutils literal notranslate"><span class="pre">${PCP_RC_DIR}/pmlogger</span></code> start script handles this.</p>
<p>Manually - create a configuration file with a text editor, or arrange to have one put in place by configuration management tools like <a class="reference external" href="https://puppet.com/">Puppet</a> or <a class="reference external" href="https://www.chef.io/products/chef-infra">Chef</a>.</p>
</li>
<li><p class="first">Edit <code class="docutils literal notranslate"><span class="pre">${PCP_PMLOGGERCONTROL_PATH}</span></code>, or one of the <code class="docutils literal notranslate"><span class="pre">${PCP_PMLOGGERCONTROL_PATH}.d</span></code> files. Using the line for <strong>remote</strong> as a template, add the following line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">venus</span> <span class="n">n</span> <span class="n">n</span> <span class="n">PCP_LOG_DIR</span><span class="o">/</span><span class="n">pmlogger</span><span class="o">/</span><span class="n">venus</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">T24h10m</span> <span class="o">-</span><span class="n">c</span> <span class="n">config</span><span class="o">.</span><span class="n">venus</span>
</pre></div>
</div>
</li>
<li><p class="first">Start <strong>pmlogger</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PCP_BINADM_DIR}/pmlogger_check
Restarting pmlogger for host &quot;venus&quot; ..... done
</pre></div>
</div>
</li>
<li><p class="first">Verify that the <strong>pmlogger</strong> instance is running:</p>
</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pcp
Performance Co-Pilot configuration on pluto:

 platform: Linux pluto 3.10.0-0.rc7.64.el7.x86_64 #1 SMP
 hardware: 8 cpus, 2 disks, 23960MB RAM
 timezone: EST-10
     pmcd: Version 3.8.3-1, 8 agents
     pmda: pmcd proc linux xfs mmv infiniband gluster elasticsearch
     pmlogger: primary logger: pluto/20170815.10.00
           venus.redhat.com: venus/20170815.11.15
pmlc
pmlc&gt; show loggers
The following pmloggers are running on pluto:
        primary (19144) 5141
pmlc&gt; connect 5141
pmlc&gt; status
pmlogger [5141] on host pluto is logging metrics from host venus
log started      Thu Aug 15 11:15:39 2017 (times in local time)
last log entry   Thu Aug 15 11:47:39 2017
current time     Thu Aug 15 11:48:13 2017
log volume       0
log size         146160
</pre></div>
</div>
<p>To create archive logs on the local host for performance metrics collected from multiple remote hosts, repeat the steps in <a class="reference internal" href="#procedure-6-1-creating-archive-logs">Procedure 6.1. Creating Archive Logs</a>
for each remote host (each with a new <strong>control</strong> file entry).</p>
</div>
<div class="section" id="archive-log-administration">
<h3><a class="toc-backref" href="#id21">6.3.3. ⁠Archive Log Administration</a><a class="headerlink" href="#archive-log-administration" title="Permalink to this headline">¶</a></h3>
<p>Assume the local host has been set up to create archive logs of performance metrics collected from one or more hosts (which may be either the local host or a remote host).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Depending on your platform, the <strong>crontab</strong> entry discussed here may already have been installed for you, as part of the package installation process. In this case,
the file <strong>/etc/cron.d/pcp-pmlogger</strong> will exist, and the rest of this section can be skipped.</p>
</div>
<p>To activate the maintenance and housekeeping scripts for a collection of archive logs, execute the following tasks while logged into the local host as the superuser (<strong>root</strong>):</p>
<ol class="arabic">
<li><p class="first">Augment the <strong>crontab</strong> file for the <strong>pcp</strong> user. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>crontab -l -u pcp &gt; ${HOME}/crontab.txt
</pre></div>
</div>
</li>
<li><p class="first">Edit <code class="docutils literal notranslate"><span class="pre">${HOME}/crontab.txt</span></code>, adding lines similar to those from the sample <code class="docutils literal notranslate"><span class="pre">${PCP_VAR_DIR}/config/pmlogger/crontab</span></code> file for <strong>pmlogger_daily</strong> and <strong>pmlogger_check</strong>;
for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># daily processing of archive logs
10     0     *     *     *    ${PCP_BINADM_DIR}/pmlogger_daily
# every 30 minutes, check pmlogger instances are running
25,55  *     *     *     *    ${PCP_BINADM_DIR}/pmlogger_check
</pre></div>
</div>
</li>
<li><p class="first">Make these changes permanent with this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>crontab -u pcp &lt; ${HOME}/crontab.txt
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="other-archive-logging-features-and-services">
<h2><a class="toc-backref" href="#id22">6.4. Other Archive Logging Features and Services</a><a class="headerlink" href="#other-archive-logging-features-and-services" title="Permalink to this headline">¶</a></h2>
<p>Other archive logging features and services include PCP archive folios, manipulating archive logs, primary logger, and using <strong>pmlc</strong>.</p>
<div class="section" id="pcp-archive-folios">
<h3><a class="toc-backref" href="#id23">6.4.1. ⁠PCP Archive Folios</a><a class="headerlink" href="#pcp-archive-folios" title="Permalink to this headline">¶</a></h3>
<p>A collection of one or more sets of PCP archive logs may be combined with a control file to produce a PCP archive folio. Archive folios are created using either <strong>mkaf</strong>
or the interactive record mode services of various PCP monitor tools (e.g. <strong>pmchart</strong> and <strong>pmrep</strong>).</p>
<p>The automated archive log management services also create an archive folio named <strong>Latest</strong> for each managed <strong>pmlogger</strong> instance, to provide a symbolic name to the
most recent archive log. With reference to <a class="reference internal" href="#figure-6-1-archive-log-directory-structure">Figure 6.1. Archive Log Directory Structure</a>, this would mean the creation of the folios <code class="docutils literal notranslate"><span class="pre">${PCP_LOG_DIR}/pmlogger/one/Latest</span></code>
and <code class="docutils literal notranslate"><span class="pre">${PCP_LOG_DIR}/pmlogger/two/Latest</span></code>.</p>
<p>The <strong>pmafm</strong> utility is completely described in the <strong>pmafm(1)</strong> man page, and provides the interactive commands (single commands may also be executed from the command line)
for the following services:</p>
<ul class="simple">
<li>Checking the integrity of the archives in the folio.</li>
<li>Displaying information about the component archives.</li>
<li>Executing PCP tools with their source of performance metrics assigned concurrently to all of the component archives (where the tool supports this), or serially
executing the PCP tool once per component archive.</li>
<li>If the folio was created by a single PCP monitoring tool, replaying all of the archives in the folio with that monitoring tool.</li>
<li>Restricting the processing to particular archives, or the archives associated with particular hosts.</li>
</ul>
</div>
<div class="section" id="manipulating-archive-logs-with-pmlogextract">
<h3><a class="toc-backref" href="#id24">6.4.2. ⁠Manipulating Archive Logs with pmlogextract</a><a class="headerlink" href="#manipulating-archive-logs-with-pmlogextract" title="Permalink to this headline">¶</a></h3>
<p>The <strong>pmlogextract</strong> tool takes a number of PCP archive logs from a single host and performs the following tasks:</p>
<ul class="simple">
<li>Merges the archives into a single log, while maintaining the correct time stamps for all values.</li>
<li>Extracts all metric values within a temporal window that could encompass several archive logs.</li>
<li>Extracts only a configurable subset of metrics from the archive logs.</li>
</ul>
<p>See the <strong>pmlogextract(1)</strong> man page for full information on this command.</p>
</div>
<div class="section" id="summarizing-archive-logs-with-pmlogsummary">
<h3><a class="toc-backref" href="#id25">6.4.3. ⁠Summarizing Archive Logs with pmlogsummary</a><a class="headerlink" href="#summarizing-archive-logs-with-pmlogsummary" title="Permalink to this headline">¶</a></h3>
<p>The <strong>pmlogsummary</strong> tool provides statistical summaries of archives, or specific metrics within archives, or specific time windows of interest in a set of archives.
These summaries include various averages, minima, maxima, sample counts, histogram bins, and so on.</p>
<p>As an example, for Linux host <strong>pluto</strong>, report on its use of anonymous huge pages - average use, maximum, time at which maximum occured, total number of samples in
the set of archives, and the units used for the values - as shown in <a class="reference internal" href="#example-6-2-using-pmlogsummary-to-summarize-archive-information">Example 6.2. Using pmlogsummary to Summarize Archive Information</a>:</p>
<p id="example-6-2-using-pmlogsummary-to-summarize-archive-information">Example 6.2. Using pmlogsummary to Summarize Archive Information</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pmlogsummary -MIly ${PCP_LOG_DIR}/pmlogger/pluto/20170815 mem.util.anonhugepages
Performance metrics from host pluto
  commencing Thu Aug 15 00:10:12.318 2017
  ending     Fri Aug 16 00:10:12.299 2017

mem.util.anonhugepages  7987742.326 8116224.000 15:02:12.300 1437 Kbyte

pminfo -t mem.util.anonhugepages
mem.util.anonhugepages [amount of memory in anonymous huge pages]
</pre></div>
</div>
<p>See the <strong>pmlogsummary(1)</strong> man page for detailed information about this commands many options.</p>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id26">6.4.4. ⁠Primary Logger</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>On each system for which PMCD is active (each PCP collector system), there is an option to have a distinguished instance of the archive logger <strong>pmlogger</strong>
(the “primary” logger) launched each time PMCD is started. This may be used to ensure the creation of minimalist archive logs required for ongoing system management
and capacity planning in the event of failure of a system where a remote <strong>pmlogger</strong> may be running, or because the preferred archive logger deployment is to activate
<strong>pmlogger</strong> on each PCP collector system.</p>
<p>Run the following command as superuser on each PCP collector system where you want to activate the primary <strong>pmlogger</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chkconfig</span> <span class="n">pmlogger</span> <span class="n">on</span>
</pre></div>
</div>
<p>The primary logger launches the next time the <code class="docutils literal notranslate"><span class="pre">${PCP_RC_DIR}/pmlogger</span></code> <strong>start</strong> script runs. If you wish this to happen immediately, follow up with this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PCP_BINADM_DIR}/pmlogger_check -V
</pre></div>
</div>
<p>When it is started in this fashion, the <code class="docutils literal notranslate"><span class="pre">${PCP_PMLOGGERCONTROL_PATH}</span></code> file (or one of the <code class="docutils literal notranslate"><span class="pre">${PCP_PMLOGGERCONTROL_PATH}.d</span></code> files) must use the second field of one
configuration line to designate the primary logger, and usually will also use the <strong>pmlogger</strong> configuration file <code class="docutils literal notranslate"><span class="pre">${PCP_SYSCONF_DIR}/pmlogger/config.default</span></code>
(although the latter is not mandatory).</p>
</div>
<div class="section" id="using-pmlc">
<h3><a class="toc-backref" href="#id27">6.4.5. ⁠Using pmlc</a><a class="headerlink" href="#using-pmlc" title="Permalink to this headline">¶</a></h3>
<p>You may tailor <strong>pmlogger</strong> dynamically with the <strong>pmlc</strong> command (if it is configured to allow access to this functionality). Normally, the <strong>pmlogger</strong> configuration
is read at startup. If you choose to modify the <strong>config</strong> file to change the parameters under which <strong>pmlogger</strong> operates, you must stop and restart the program for
your changes to have effect. Alternatively, you may change parameters whenever required by using the <strong>pmlc</strong> interface.</p>
<p>To run the <strong>pmlc</strong> tool, enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pmlc</span>
</pre></div>
</div>
<p>By default, <strong>pmlc</strong> acts on the primary instance of <strong>pmlogger</strong> on the current host. See the <strong>pmlc(1)</strong> man page for a description of command line options. When it
is invoked, <strong>pmlc</strong> presents you with a prompt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pmlc</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>You may obtain a listing of the available commands by entering a question mark (?) and pressing <strong>Enter</strong>. You see output similar to that in
<a class="reference internal" href="#example-6-3-listing-available-commands">Example 6.3. Listing Available Commands</a>:</p>
<p id="example-6-3-listing-available-commands"><strong>Example 6.3. Listing Available Commands</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>show loggers [@&lt;host&gt;]           display &lt;pid&gt;s of running pmloggers
connect _logger_id [@&lt;host&gt;]     connect to designated pmlogger
status                           information about connected pmlogger
query metric-list                show logging state of metrics
new volume                       start a new log volume
flush                            flush the log buffers to disk
log { mandatory | advisory } on &lt;interval&gt; _metric-list
log { mandatory | advisory } off _metric-list
log mandatory maybe _metric-list
timezone local|logger|&#39;&lt;timezone&gt;&#39; change reporting timezone
help                               print this help message
quit                               exit from pmlc
_logger_id   is  primary | &lt;pid&gt; | port &lt;n&gt;
_metric-list is  _metric-spec | { _metric-spec ... }
_metric-spec is  &lt;metric-name&gt; | &lt;metric-name&gt; [ &lt;instance&gt; ... ]
</pre></div>
</div>
<p>Here is an example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pmlc
pmlc&gt; show loggers @babylon
The following pmloggers are running on babylon:
       primary (1892)
pmlc&gt; connect 1892 @babylon
pmlc&gt; log advisory on 2 secs disk.dev.read
pmlc&gt; query disk.dev
disk.dev.read
       adv  on  nl       5 min  [131073 or “disk1”]
       adv  on  nl       5 min  [131074 or “disk2”]
pmlc&gt; quit
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any changes to the set of logged metrics made via <strong>pmlc</strong> are not saved, and are lost the next time <strong>pmlogger</strong> is started with the same configuration file.
Permanent changes are made by modifying the <strong>pmlogger</strong> configuration file(s).</p>
</div>
<p>Refer to the <strong>pmlc(1)</strong> and <strong>pmlogger(1)</strong> man pages for complete details.</p>
</div>
</div>
<div class="section" id="archive-logging-troubleshooting">
<h2><a class="toc-backref" href="#id28">6.5. Archive Logging Troubleshooting</a><a class="headerlink" href="#archive-logging-troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>The following issues concern the creation and use of logs using <strong>pmlogger</strong>.</p>
<div class="section" id="pmlogger-cannot-write-log">
<h3><a class="toc-backref" href="#id29">6.5.1. pmlogger Cannot Write Log</a><a class="headerlink" href="#pmlogger-cannot-write-log" title="Permalink to this headline">¶</a></h3>
<p><strong>Symptom:</strong></p>
<p>The <strong>pmlogger</strong> utility does not start, and you see this message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>__pmLogNewFile: “foo.index” already exists, not over-written
</pre></div>
</div>
<p><strong>Cause:</strong></p>
<p>Archive logs are considered sufficiently precious that <strong>pmlogger</strong> does not empty or overwrite an existing set of archive log files. The log named <strong>foo</strong> actually
consists of the physical file <strong>foo.index</strong>, <strong>foo.meta</strong>, and at least one file <strong>foo.N</strong>, where <strong>N</strong> is in the range 0, 1, 2, 3, and so on.</p>
<p>A message similar to the one above is produced when a new <strong>pmlogger</strong> instance encounters one of these files already in existence.</p>
<p><strong>Resolution:</strong></p>
<p>Move the existing archive aside, or if you are sure, remove all of the parts of the archive log. For example, use the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">foo</span><span class="o">.*</span>
</pre></div>
</div>
<p>Then rerun <strong>pmlogger</strong>.</p>
</div>
<div class="section" id="cannot-find-log">
<h3><a class="toc-backref" href="#id30">6.5.2. ⁠Cannot Find Log</a><a class="headerlink" href="#cannot-find-log" title="Permalink to this headline">¶</a></h3>
<p><strong>Symptom:</strong></p>
<p>The <strong>pmdumplog</strong> utility, or any tool that can read an archive log, displays this message:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cannot open archive mylog: No such file or directory
</pre></div>
</div>
<p><strong>Cause:</strong></p>
<p>An archive consists of at least three physical files. If the base name for the archive is <strong>mylog</strong>, then the archive actually consists of the physical files
<strong>mylog.index</strong>, <strong>mylog.meta</strong>, and at least one file <strong>mylog.N</strong>, where <strong>N</strong> is in the range 0, 1, 2, 3, and so on.</p>
<p>The above message is produced if one or more of the files is missing.</p>
<p><strong>Resolution:</strong></p>
<p>Use this command to check which files the utility is trying to open:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="n">mylog</span><span class="o">.*</span>
</pre></div>
</div>
<p>Turn on the internal debug flag <strong>DBG_TRACE_LOG</strong> (<strong>-D</strong> 128) to see which files are being inspected by the <strong>pmOpenLog</strong> routine as shown in the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pmdumplog</span> <span class="o">-</span><span class="n">D</span> <span class="mi">128</span> <span class="o">-</span><span class="n">l</span> <span class="n">mylog</span>
</pre></div>
</div>
<p>Locate the missing files and move them all to the same directory, or remove all of the files that are part of the archive, and recreate the archive log.</p>
</div>
<div class="section" id="primary-pmlogger-cannot-start">
<h3><a class="toc-backref" href="#id31">6.5.3. Primary pmlogger Cannot Start</a><a class="headerlink" href="#primary-pmlogger-cannot-start" title="Permalink to this headline">¶</a></h3>
<p><strong>Symptom:</strong></p>
<p>The primary <strong>pmlogger</strong> cannot be started. A message like the following appears:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pmlogger: there is already a primary pmlogger running
</pre></div>
</div>
<p><strong>Cause:</strong></p>
<p>There is either a primary <strong>pmlogger</strong> already running, or the previous primary <strong>pmlogger</strong> was terminated unexpectedly before it could perform its cleanup operations.</p>
<p><strong>Resolution:</strong></p>
<p>If there is already a primary <strong>pmlogger</strong> running and you wish to replace it with a new <strong>pmlogger</strong>, use the <strong>show</strong> command in <strong>pmlc</strong> to determine the process ID
of the primary <strong>pmlogger</strong>. The process ID of the primary <strong>pmlogger</strong> appears in parentheses after the word “primary.” Send a <strong>SIGINT</strong> signal to the process to
shut it down (use either the <strong>kill</strong> command if the platform supports it, or the <strong>pmsignal</strong> command). If the process does not exist, proceed to the manual cleanup
described in the paragraph below. If the process did exist, it should now be possible to start the new <strong>pmlogger</strong>.</p>
<p>If <strong>pmlc’s show</strong> command displays a process ID for a process that does not exist, a <strong>pmlogger</strong> process was terminated before it could clean up. If it was the
primary <strong>pmlogger</strong>, the corresponding control files must be removed before one can start a new primary <strong>pmlogger</strong>. It is a good idea to clean up any spurious
control files even if they are not for the primary <strong>pmlogger</strong>.</p>
<p>The control files are kept in <code class="docutils literal notranslate"><span class="pre">${PCP_TMP_DIR}/pmlogger</span></code>. A control file with the process ID of the <strong>pmlogger</strong> as its name is created when the <strong>pmlogger</strong> is started.
In addition, the primary <strong>pmlogger</strong> creates a symbolic link named <strong>primary</strong> to its control file.</p>
<p>For the primary <strong>pmlogger</strong>, remove both the symbolic link and the file (corresponding to its process ID) to which the link points. For other <strong>pmloggers</strong>, remove
just the process ID file. Do not remove any other files in the directory. If the control file for an active <strong>pmlogger</strong> is removed, <strong>pmlc</strong> is not able to contact it.</p>
</div>
<div class="section" id="identifying-an-active-pmlogger-process">
<h3><a class="toc-backref" href="#id32">6.5.4. Identifying an Active pmlogger Process</a><a class="headerlink" href="#identifying-an-active-pmlogger-process" title="Permalink to this headline">¶</a></h3>
<p><strong>Symptom:</strong></p>
<p>You have a PCP archive log that is demonstrably growing, but do not know the identify of the associated <strong>pmlogger</strong> process.</p>
<p><strong>Cause:</strong></p>
<p>The PID is not obvious from the log, or the archive name may not be obvious from the output of the <strong>ps</strong> command.</p>
<p><strong>Resolution:</strong></p>
<p>If the archive basename is <strong>foo</strong>, run the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pmdumplog -l foo
Log Label (Log Format Version 1)
Performance metrics from host gonzo
     commencing Wed Aug  7 00:10:09.214 1996
     ending     Wed Aug  7 16:10:09.155 1996

pminfo -a foo -f pmcd.pmlogger
pmcd.pmlogger.host
     inst [10728 or &quot;10728&quot;] value &quot;gonzo&quot;
pmcd.pmlogger.port
     inst [10728 or &quot;10728&quot;] value 4331
pmcd.pmlogger.archive
     inst [10728 or &quot;10728&quot;] value &quot;/usr/var/adm/pcplog/gonzo/foo&quot;
</pre></div>
</div>
<p>All of the information describing the creator of the archive is revealed and, in particular, the instance identifier for the PMCD metrics (<strong>10728</strong> in the example
above) is the PID of the <strong>pmlogger</strong> instance, which may be used to control the process via <strong>pmlc</strong>.</p>
</div>
<div class="section" id="illegal-label-record">
<h3><a class="toc-backref" href="#id33">6.5.5. Illegal Label Record</a><a class="headerlink" href="#illegal-label-record" title="Permalink to this headline">¶</a></h3>
<p><strong>Symptom:</strong></p>
<p>PCP tools report:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Illegal</span> <span class="n">label</span> <span class="n">record</span> <span class="n">at</span> <span class="n">start</span> <span class="n">of</span> <span class="n">PCP</span> <span class="n">archive</span> <span class="n">log</span> <span class="n">file</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>Cause:</strong></p>
<p>The label record at the start of each of the physical archive log files has become either corrupted or one is out of sync with the others.</p>
<p><strong>Resolution:</strong></p>
<p>If you believe the log may have been corrupted, this can be verified using <strong>pmlogcheck</strong>. If corruption is limited to just the label record at the start, the <strong>pmloglabel</strong>
can be used to force the labels back in sync with each other, with known-good values that you supply.</p>
<p>Refer to the <strong>pmlogcheck(1)</strong> and <strong>pmloglabel(1)</strong> man pages.</p>
</div>
<div class="section" id="empty-archive-log-files-or-pmlogger-exits-immediately">
<h3><a class="toc-backref" href="#id34">6.5.6. ⁠Empty Archive Log Files or pmlogger Exits Immediately</a><a class="headerlink" href="#empty-archive-log-files-or-pmlogger-exits-immediately" title="Permalink to this headline">¶</a></h3>
<p>⁠
<strong>Symptom:</strong></p>
<p>Archive log files are zero size, requested metrics are not being logged, or <strong>pmlogger</strong> exits immediately with no error messages.</p>
<p><strong>Cause:</strong></p>
<p>Either <strong>pmlogger</strong> encountered errors in the configuration file, has not flushed its output buffers yet, or some (or all) metrics specified in the <strong>pmlogger</strong>
configuration file have had their state changed to advisory <strong>off</strong> or mandatory <strong>off</strong> via <strong>pmlc</strong>. It is also possible that the logging interval specified in the
<strong>pmlogger</strong> configuration file for some or all of the metrics is longer than the period of time you have been waiting since <strong>pmlogger</strong> started.</p>
<p><strong>Resolution:</strong></p>
<p>If <strong>pmlogger</strong> exits immediately with no error messages, check the <strong>pmlogger.log</strong> file in the directory <strong>pmlogger</strong> was started in for any error messages. If
<strong>pmlogger</strong> has not yet flushed its buffers, enter one of the following commands (depending on platform support):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>killall -SIGUSR1 pmlogger
${PCP_BINADM_DIR}/pmsignal -a -s USR1 pmlogger
</pre></div>
</div>
<p>Otherwise, use the <strong>status</strong> command for <strong>pmlc</strong> to interrogate the internal <strong>pmlogger</strong> state of specific metrics.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="PcpDeploymentStrategies.html" class="btn btn-neutral float-right" title="7. Performance Co-Pilot Deployment Strategies" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="PerformanceMetricsInferenceEngine.html" class="btn btn-neutral float-left" title="5. Performance Metrics Inference Engine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Performance Co-Pilot

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>